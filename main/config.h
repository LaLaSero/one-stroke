#ifndef CONFIG_H
#define CONFIG_H

#include <Arduino.h>
#include <avr/pgmspace.h>

#define NUM_POINT 366
#define CPR_COUNT 360
#define GEAR_RATIO 1.0

#define L0 150
#define L1 90
#define L2 140

#define P_GAIN 8.0
#define I_GAIN 0.0
#define D_GAIN 0.2

const unsigned long targetUpdateInterval = 100;
const unsigned long controlLoopInterval = 10; 

// モータ制御ピン（右側）
const int right_IN1 = 6;
const int right_IN2 = 7;
const int right_OUT1 = 18; // エンコーダーA
const int right_OUT2 = 19; // エンコーダーB

// モータ制御ピン（左側）
const int left_IN1 = 12;
const int left_IN2 = 13;
const int left_OUT1 = 20; // エンコーダーA
const int left_OUT2 = 21; // エンコーダーB

// エンコーダーの設定
const int CPR = CPR_COUNT;        // エンコーダーのカウント数（例）
const float GearRatio = GEAR_RATIO; // ギア比（例）

volatile long rightEncoderCount = 0;
volatile long leftEncoderCount = 0;

// PID制御用のパラメータ
float Kp = P_GAIN;
float Ki = I_GAIN;
float Kd = D_GAIN;

// PID制御用の変数（右側）
float integral_right = 0;
float prevError_right = 0;

// PID制御用の変数（左側）
float integral_left = 0;
float prevError_left = 0;

// 制御周期
unsigned long prevTime = 0;
// const unsigned long controlInterval = CONTROL_INTERVAL; // ミリ秒
unsigned long prevTimeTargetUpdate = 0;
unsigned long prevTimeControlLoop = 0;

// 目標位置（ペン先の座標）
float x_target = 150.0; // 単位：mm
float y_target = 50.0;  // 単位：mm


// モーターの目標角度（degrees）
float theta_target_right = 0.0;
float theta_target_left = 0.0;

float theta_current_right = 0.0;
float theta_current_left = 0.0;

// リンクの長さ
const float l0 = L0; // モーター間の距離（mm）
const float l1 = L1; // 第1リンクの長さ（mm）
const float l2 = L2; // 第2リンクの長さ（mm）

const int numPoints = NUM_POINT;

const float x_targets[NUM_POINT] PROGMEM = {
  1.250000000000000000e+02,1.239795918367346985e+02,1.229591836734693828e+02,1.219387755102040813e+02,1.209183673469387799e+02,1.198979591836734642e+02,1.188775510204081627e+02,1.178571428571428612e+02,1.168367346938775455e+02,1.158163265306122440e+02,1.147959183673469425e+02,1.137755102040816269e+02,1.127551020408163254e+02,1.117346938775510239e+02,1.107142857142857082e+02,1.096938775510204067e+02,1.086734693877551052e+02,1.076530612244897895e+02,1.066326530612244881e+02,1.056122448979591866e+02,1.045918367346938851e+02,1.035714285714285694e+02,1.025510204081632679e+02,1.015306122448979522e+02,1.005102040816326507e+02,9.948979591836734926e+01,9.846938775510204778e+01,9.744897959183673208e+01,9.642857142857143060e+01,9.540816326530611491e+01,9.438775510204081343e+01,9.336734693877551194e+01,9.234693877551021046e+01,9.132653061224489477e+01,9.030612244897959329e+01,8.928571428571427759e+01,8.826530612244897611e+01,8.724489795918367463e+01,8.622448979591837315e+01,8.520408163265305745e+01,8.418367346938775597e+01,8.316326530612244028e+01,8.214285714285713880e+01,8.112244897959183731e+01,8.010204081632653583e+01,7.908163265306122014e+01,7.806122448979591866e+01,7.704081632653060296e+01,7.602040816326530148e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.397959183673469852e+01,7.295918367346938282e+01,7.193877551020408134e+01,7.091836734693877986e+01,6.989795918367346417e+01,6.887755102040816269e+01,6.785714285714286120e+01,6.683673469387754551e+01,6.581632653061224403e+01,6.479591836734694255e+01,6.377551020408163396e+01,6.275510204081632537e+01,6.173469387755102389e+01,6.071428571428571530e+01,5.969387755102040671e+01,5.867346938775510523e+01,5.765306122448979664e+01,5.663265306122448806e+01,5.561224489795918657e+01,5.459183673469387799e+01,5.357142857142856940e+01,5.255102040816326792e+01,5.153061224489795933e+01,5.051020408163265074e+01,4.948979591836734926e+01,4.846938775510204067e+01,4.744897959183673208e+01,4.642857142857143060e+01,4.540816326530612201e+01,4.438775510204081343e+01,4.336734693877551194e+01,4.234693877551020336e+01,4.132653061224489477e+01,4.030612244897959329e+01,3.928571428571428470e+01,3.826530612244897611e+01,3.724489795918367463e+01,3.622448979591836604e+01,3.520408163265305745e+01,3.418367346938775597e+01,3.316326530612244738e+01,3.214285714285713880e+01,3.112244897959183731e+01,3.010204081632652873e+01,2.908163265306122014e+01,2.806122448979591866e+01,2.704081632653061007e+01,2.602040816326530148e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.704081632653061362e+01,2.908163265306122369e+01,3.112244897959183731e+01,3.316326530612244738e+01,3.520408163265305745e+01,3.724489795918367463e+01,3.928571428571428470e+01,4.132653061224489477e+01,4.336734693877551194e+01,4.540816326530612201e+01,4.744897959183673208e+01,4.948979591836734926e+01,5.153061224489795933e+01,5.357142857142856940e+01,5.561224489795918657e+01,5.765306122448979664e+01,5.969387755102040671e+01,6.173469387755102389e+01,6.377551020408163396e+01,6.581632653061224403e+01,6.785714285714286120e+01,6.989795918367346417e+01,7.193877551020408134e+01,7.397959183673469852e+01,7.602040816326530148e+01,7.806122448979591866e+01,8.010204081632653583e+01,8.214285714285713880e+01,8.418367346938775597e+01,8.622448979591837315e+01,8.826530612244897611e+01,9.030612244897959329e+01,9.234693877551021046e+01,9.438775510204081343e+01,9.642857142857143060e+01,9.846938775510204778e+01,1.005102040816326507e+02,1.025510204081632679e+02,1.045918367346938851e+02,1.066326530612244881e+02,1.086734693877551052e+02,1.107142857142857224e+02,1.127551020408163254e+02,1.147959183673469425e+02,1.168367346938775597e+02,1.188775510204081627e+02,1.209183673469387799e+02,1.229591836734693970e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.250000000000000000e+02,1.241304347826087024e+02,1.232608695652173907e+02,1.223913043478260931e+02,1.215217391304347814e+02,1.206521739130434838e+02,1.197826086956521721e+02,1.189130434782608745e+02,1.180434782608695627e+02,1.171739130434782652e+02,1.163043478260869534e+02,1.154347826086956559e+02,1.145652173913043441e+02,1.136956521739130466e+02,1.128260869565217348e+02,1.119565217391304373e+02,1.110869565217391255e+02,1.102173913043478279e+02,1.093478260869565162e+02,1.084782608695652186e+02,1.076086956521739069e+02,1.067391304347826093e+02,1.058695652173913118e+02,1.050000000000000000e+02,1.041304347826086882e+02,1.032608695652173907e+02,1.023913043478260931e+02,1.015217391304347814e+02,1.006521739130434838e+02,9.978260869565217206e+01,9.891304347826087451e+01,9.804347826086956275e+01,9.717391304347826519e+01,9.630434782608695343e+01,9.543478260869565588e+01,9.456521739130434412e+01,9.369565217391304657e+01,9.282608695652174902e+01,9.195652173913043725e+01,9.108695652173912549e+01,9.021739130434782794e+01,8.934782608695653039e+01,8.847826086956521863e+01,8.760869565217390686e+01,8.673913043478260931e+01,8.586956521739131176e+01,8.500000000000000000e+01,8.413043478260868824e+01,8.326086956521739069e+01,8.239130434782609314e+01,8.152173913043478137e+01,8.065217391304346961e+01,7.978260869565217206e+01,7.891304347826087451e+01,7.804347826086956275e+01,7.717391304347826519e+01,7.630434782608696764e+01,7.543478260869565588e+01,7.456521739130434412e+01,7.369565217391304657e+01,7.282608695652174902e+01,7.195652173913043725e+01,7.108695652173912549e+01,7.021739130434782794e+01,6.934782608695653039e+01,6.847826086956521863e+01,6.760869565217390686e+01,6.673913043478260931e+01,6.586956521739131176e+01,6.500000000000000000e+01,6.413043478260868824e+01,6.326086956521739069e+01,6.239130434782608603e+01,6.152173913043478137e+01,6.065217391304348382e+01,5.978260869565217206e+01,5.891304347826087451e+01,5.804347826086956275e+01,5.717391304347826519e+01,5.630434782608695343e+01,5.543478260869565588e+01,5.456521739130434412e+01,5.369565217391304657e+01,5.282608695652173481e+01,5.195652173913043725e+01,5.108695652173912549e+01,5.021739130434782794e+01,4.934782608695653039e+01,4.847826086956521863e+01,4.760869565217392108e+01,4.673913043478260931e+01,4.586956521739131176e+01,4.500000000000000000e+01,4.413043478260870245e+01,4.326086956521739069e+01,4.239130434782609314e+01,4.152173913043478137e+01,4.065217391304348382e+01,3.978260869565217206e+01,3.891304347826087451e+01,3.804347826086956275e+01,3.717391304347826519e+01,3.630434782608695343e+01,3.543478260869565588e+01,3.456521739130434412e+01,3.369565217391304657e+01,3.282608695652173481e+01,3.195652173913043725e+01,3.108695652173913970e+01,3.021739130434782794e+01,2.934782608695653039e+01,2.847826086956521863e+01,2.760869565217392108e+01,2.673913043478260931e+01,2.586956521739131176e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,2.500000000000000000e+01,
  };

const float y_targets[NUM_POINT] PROGMEM = {
  7.500000000000000000e+01,7.676739878323354560e+01,7.853479756646709120e+01,8.030219634970063680e+01,8.206959513293419661e+01,8.383699391616774221e+01,8.560439269940128781e+01,8.737179148263483341e+01,8.913919026586837902e+01,9.090658904910192462e+01,9.267398783233548443e+01,9.444138661556903003e+01,9.620878539880257563e+01,9.797618418203612123e+01,9.974358296526966683e+01,1.015109817485032124e+02,1.032783805317367580e+02,1.050457793149703178e+02,1.068131780982038634e+02,1.085805768814374090e+02,1.103479756646709546e+02,1.121153744479045145e+02,1.138827732311380601e+02,1.156501720143716057e+02,1.174175707976051513e+02,1.191849695808386969e+02,1.209523683640722425e+02,1.227197671473057881e+02,1.244871659305393337e+02,1.262545647137728793e+02,1.280219634970064249e+02,1.297893622802399705e+02,1.315567610634735161e+02,1.333241598467070617e+02,1.350915586299406357e+02,1.368589574131741813e+02,1.386263561964077269e+02,1.403937549796412725e+02,1.421611537628748181e+02,1.439285525461083637e+02,1.456959513293419093e+02,1.474633501125754549e+02,1.492307488958090289e+02,1.509981476790425745e+02,1.527655464622761201e+02,1.545329452455096657e+02,1.563003440287432113e+02,1.580677428119767569e+02,1.598351415952103025e+02,1.616025403784438481e+02,1.616025403784438481e+02,1.598351415952103025e+02,1.580677428119767569e+02,1.563003440287432113e+02,1.545329452455096657e+02,1.527655464622761201e+02,1.509981476790425745e+02,1.492307488958090005e+02,1.474633501125754549e+02,1.456959513293419093e+02,1.439285525461083637e+02,1.421611537628748181e+02,1.403937549796412725e+02,1.386263561964077269e+02,1.368589574131741813e+02,1.350915586299406357e+02,1.333241598467070901e+02,1.315567610634735445e+02,1.297893622802399989e+02,1.280219634970064249e+02,1.262545647137728935e+02,1.244871659305393337e+02,1.227197671473057881e+02,1.209523683640722425e+02,1.191849695808386969e+02,1.174175707976051513e+02,1.156501720143716057e+02,1.138827732311380601e+02,1.121153744479045145e+02,1.103479756646709689e+02,1.085805768814374233e+02,1.068131780982038634e+02,1.050457793149703178e+02,1.032783805317367722e+02,1.015109817485032124e+02,9.974358296526966683e+01,9.797618418203612123e+01,9.620878539880257563e+01,9.444138661556903003e+01,9.267398783233548443e+01,9.090658904910193883e+01,8.913919026586839323e+01,8.737179148263483341e+01,8.560439269940128781e+01,8.383699391616774221e+01,8.206959513293419661e+01,8.030219634970065101e+01,7.853479756646710541e+01,7.676739878323354560e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.500000000000000000e+01,7.704081632653061718e+01,7.908163265306122014e+01,8.112244897959183731e+01,8.316326530612245449e+01,8.520408163265305745e+01,8.724489795918367463e+01,8.928571428571429180e+01,9.132653061224489477e+01,9.336734693877551194e+01,9.540816326530611491e+01,9.744897959183673208e+01,9.948979591836734926e+01,1.015306122448979522e+02,1.035714285714285694e+02,1.056122448979591866e+02,1.076530612244897895e+02,1.096938775510204067e+02,1.117346938775510239e+02,1.137755102040816269e+02,1.158163265306122440e+02,1.178571428571428612e+02,1.198979591836734642e+02,1.219387755102040813e+02,1.239795918367346985e+02,1.260204081632653015e+02,1.280612244897959044e+02,1.301020408163265358e+02,1.321428571428571388e+02,1.341836734693877702e+02,1.362244897959183731e+02,1.382653061224489761e+02,1.403061224489795791e+02,1.423469387755102105e+02,1.443877551020408134e+02,1.464285714285714448e+02,1.484693877551020478e+02,1.505102040816326507e+02,1.525510204081632537e+02,1.545918367346938851e+02,1.566326530612244881e+02,1.586734693877551194e+02,1.607142857142857224e+02,1.627551020408163254e+02,1.647959183673469283e+02,1.668367346938775597e+02,1.688775510204081627e+02,1.709183673469387941e+02,1.729591836734693970e+02,1.750000000000000000e+02,1.750000000000000000e+02,1.715519848771266993e+02,1.681644612476370639e+02,1.648374291115312076e+02,1.615708884688090734e+02,1.583648393194707182e+02,1.552192816635160568e+02,1.521342155009451744e+02,1.491096408317580426e+02,1.461455576559546330e+02,1.432419659735349455e+02,1.403988657844990655e+02,1.376162570888468792e+02,1.348941398865784436e+02,1.322325141776937585e+02,1.296313799621928240e+02,1.270907372400755975e+02,1.246105860113421500e+02,1.221909262759924246e+02,1.198317580340264783e+02,1.175330812854442115e+02,1.152948960302457522e+02,1.131172022684310150e+02,1.110000000000000000e+02,1.089432892249527214e+02,1.069470699432892218e+02,1.050113421550094586e+02,1.031361058601134175e+02,1.013213610586011555e+02,9.956710775047258721e+01,9.787334593572779795e+01,9.624007561436673086e+01,9.466729678638941436e+01,9.315500945179583425e+01,9.170321361058601894e+01,9.031190926275991160e+01,8.898109640831758327e+01,8.771077504725899132e+01,8.650094517958412155e+01,8.535160680529300237e+01,8.426275992438563378e+01,8.323440453686201579e+01,8.226654064272211997e+01,8.135916824196596053e+01,8.051228733459358011e+01,7.972589792060492186e+01,7.900000000000000000e+01,7.833459357277882873e+01,7.772967863894139384e+01,7.718525519848770955e+01,7.670132325141776164e+01,7.627788279773156432e+01,7.591493383742911760e+01,7.561247637051039305e+01,7.537051039697541910e+01,7.518903591682419574e+01,7.506805293005670876e+01,7.500756143667297238e+01,7.500756143667297238e+01,7.506805293005670876e+01,7.518903591682419574e+01,7.537051039697541910e+01,7.561247637051039305e+01,7.591493383742911760e+01,7.627788279773156432e+01,7.670132325141776164e+01,7.718525519848770955e+01,7.772967863894139384e+01,7.833459357277882873e+01,7.900000000000000000e+01,7.972589792060492186e+01,8.051228733459358011e+01,8.135916824196597474e+01,8.226654064272211997e+01,8.323440453686200158e+01,8.426275992438563378e+01,8.535160680529300237e+01,8.650094517958412155e+01,8.771077504725897711e+01,8.898109640831758327e+01,9.031190926275991160e+01,9.170321361058601894e+01,9.315500945179583425e+01,9.466729678638941436e+01,9.624007561436673086e+01,9.787334593572779795e+01,9.956710775047258721e+01,1.013213610586011129e+02,1.031361058601134175e+02,1.050113421550094301e+02,1.069470699432892218e+02,1.089432892249527214e+02,1.110000000000000000e+02,1.131172022684309866e+02,1.152948960302457522e+02,1.175330812854442115e+02,1.198317580340264783e+02,1.221909262759924246e+02,1.246105860113421500e+02,1.270907372400755975e+02,1.296313799621928240e+02,1.322325141776937585e+02,1.348941398865784436e+02,1.376162570888468792e+02,1.403988657844990655e+02,1.432419659735349455e+02,1.461455576559546330e+02,1.491096408317580426e+02,1.521342155009451460e+02,1.552192816635160568e+02,1.583648393194706614e+02,1.615708884688090734e+02,1.648374291115311507e+02,1.681644612476370639e+02,1.715519848771266425e+02,1.750000000000000000e+02,1.750000000000000000e+02,1.729591836734693970e+02,1.709183673469387656e+02,1.688775510204081627e+02,1.668367346938775597e+02,1.647959183673469283e+02,1.627551020408163254e+02,1.607142857142857224e+02,1.586734693877550910e+02,1.566326530612244881e+02,1.545918367346938851e+02,1.525510204081632537e+02,1.505102040816326507e+02,1.484693877551020478e+02,1.464285714285714164e+02,1.443877551020408134e+02,1.423469387755102105e+02,1.403061224489795791e+02,1.382653061224489761e+02,1.362244897959183731e+02,1.341836734693877702e+02,1.321428571428571388e+02,1.301020408163265358e+02,1.280612244897959044e+02,1.260204081632653015e+02,1.239795918367346985e+02,1.219387755102040813e+02,1.198979591836734642e+02,1.178571428571428612e+02,1.158163265306122440e+02,1.137755102040816269e+02,1.117346938775510239e+02,1.096938775510204067e+02,1.076530612244897895e+02,1.056122448979591866e+02,1.035714285714285694e+02,1.015306122448979522e+02,9.948979591836734926e+01,9.744897959183673208e+01,9.540816326530611491e+01,9.336734693877551194e+01,9.132653061224489477e+01,8.928571428571427759e+01,8.724489795918367463e+01,8.520408163265305745e+01,8.316326530612244028e+01,8.112244897959183731e+01,7.908163265306122014e+01,7.704081632653060296e+01,7.500000000000000000e+01,
 };

#endif